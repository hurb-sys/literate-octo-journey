<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ì¹´ë“œ (í•œ ë²ˆ ì—´ë¦¼ + ì‚°íƒ€ + ì‚¬ê°íŒŒ ìºëŸ´)</title>
  <style>
    :root{
      --bg1:#0b1020;
      --bg2:#050713;
      --glass: rgba(255,255,255,.10);
      --line: rgba(255,255,255,.18);
      --txt: rgba(255,255,255,.92);
      --muted: rgba(255,255,255,.75);
    }

    body{
      margin:0;
      min-height:100vh;
      display:grid;
      place-items:center;
      background: radial-gradient(circle at top, #1b2a4a 0%, var(--bg1) 55%, var(--bg2) 100%);
      font-family: system-ui, -apple-system, "Apple SD Gothic Neo", "Malgun Gothic", sans-serif;
      color: var(--txt);
      overflow:hidden;
    }

    /* ëˆˆ */
    .snow{
      position:fixed;
      inset:0;
      pointer-events:none;
      background-image:
        radial-gradient(2px 2px at 20px 30px, rgba(255,255,255,.9) 50%, transparent 55%),
        radial-gradient(1.5px 1.5px at 120px 80px, rgba(255,255,255,.7) 50%, transparent 55%),
        radial-gradient(2px 2px at 70px 140px, rgba(255,255,255,.6) 50%, transparent 55%),
        radial-gradient(1px 1px at 200px 60px, rgba(255,255,255,.8) 50%, transparent 55%),
        radial-gradient(1.5px 1.5px at 260px 160px, rgba(255,255,255,.7) 50%, transparent 55%);
      background-size: 320px 220px;
      animation: snowfall 10s linear infinite;
      opacity:.9;
    }
    @keyframes snowfall{
      from{ transform: translateY(-10%); }
      to{ transform: translateY(110%); }
    }

    .hint{
      position:fixed;
      top:16px;
      left:50%;
      transform:translateX(-50%);
      padding:10px 14px;
      border-radius:999px;
      background: rgba(0,0,0,.25);
      border:1px solid var(--line);
      font-size:13px;
      color: var(--muted);
      user-select:none;
    }

    .stage{
      width:min(820px, 94vw);
      height:min(480px, 70vh);
      perspective: 1400px;
      position:relative;
    }

    .card{
      width:100%;
      height:100%;
      position:absolute;
      inset:0;
      transform-style: preserve-3d;
      transition: transform 900ms cubic-bezier(.2,.9,.2,1);
    }

    .front, .inside{
      position:absolute;
      inset:0;
      border-radius:24px;
      background: linear-gradient(180deg, var(--glass), rgba(255,255,255,.06));
      border:1px solid var(--line);
      box-shadow: 0 20px 60px rgba(0,0,0,.45);
      backdrop-filter: blur(10px);
      overflow:hidden;
    }

    .front{
      display:flex;
      align-items:center;
      justify-content:center;
      flex-direction:column;
      gap:14px;
      backface-visibility:hidden;
    }

    .front h1{
      margin:0;
      font-size: clamp(26px, 4vw, 44px);
      letter-spacing:.2px;
    }
    .front p{
      margin:0;
      color: var(--muted);
      font-size: clamp(13px, 2.2vw, 18px);
      text-align:center;
      padding:0 18px;
      line-height:1.5;
    }

    .badge{
      padding:8px 12px;
      border-radius:999px;
      background: rgba(255,255,255,.12);
      border:1px solid var(--line);
      font-size:13px;
      color: var(--muted);
      user-select:none;
    }

    .inside{
      transform: rotateY(180deg);
      padding:26px;
      display:grid;
      grid-template-columns: 1.1fr .9fr;
      gap:18px;
      backface-visibility:hidden;
    }

    .inside .left{
      background: rgba(0,0,0,.18);
      border:1px solid rgba(255,255,255,.14);
      border-radius:18px;
      padding:18px;
      overflow:auto;
    }

    .inside h2{
      margin:0 0 10px;
      font-size: clamp(20px, 3vw, 30px);
    }

    .msg{
      font-size: clamp(14px, 2.2vw, 18px);
      line-height:1.75;
      color: rgba(255,255,255,.92);
    }

    .sig{
      margin-top:14px;
      color: var(--muted);
      display:flex;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      font-size: 14px;
    }
    .sig strong{ color: #fff; }

    .right{
      position:relative;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      overflow:hidden;
      display:grid;
      place-items:center;
    }

    /* ì‚°íƒ€ ë“±ì¥ */
    .santaWrap{
      width:min(260px, 60%);
      opacity:0;
      transform: translateY(40px) scale(.96);
      transition: opacity 700ms ease, transform 900ms cubic-bezier(.2,.9,.2,1);
      filter: drop-shadow(0 14px 30px rgba(0,0,0,.35));
    }
    .open .santaWrap{
      opacity:1;
      transform: translateY(0) scale(1);
      transition-delay: 250ms;
    }

    .bubble{
      position:absolute;
      top:14px;
      left:14px;
      right:14px;
      padding:12px 14px;
      border-radius:16px;
      background: rgba(0,0,0,.22);
      border:1px solid rgba(255,255,255,.14);
      color: var(--muted);
      font-size: 14px;
      line-height:1.4;
    }

    /* í•˜ë‹¨ ë²„íŠ¼ */
    .controls{
      position:absolute;
      bottom:14px;
      left:14px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }

    button{
      border:0;
      cursor:pointer;
      padding:10px 12px;
      border-radius:12px;
      background: rgba(255,255,255,.14);
      color:#fff;
      border:1px solid rgba(255,255,255,.2);
      font-weight:650;
      font-size:14px;
    }
    button:hover{ background: rgba(255,255,255,.18); }

    /* ì—´ë¦° ìƒíƒœ */
    .open .card{ transform: rotateY(180deg); }

    .clickable{
      position:absolute;
      inset:0;
      border-radius:24px;
      cursor:pointer;
    }
    .clickable:active{ transform: scale(.998); }

    @media (prefers-reduced-motion: reduce){
      .card, .santaWrap, .snow{ animation:none; transition:none; }
    }
  </style>
</head>
<body>
  <div class="snow" aria-hidden="true"></div>
  <div class="hint">ì¹´ë“œë¥¼ í•œ ë²ˆ í´ë¦­í•˜ë©´ í¼ì³ì§€ê³ , ìºëŸ´ì´ ì¬ìƒë¼ìš” ğŸ¶</div>

  <div class="stage open-once" id="stage" aria-label="í¬ë¦¬ìŠ¤ë§ˆìŠ¤ ì¹´ë“œ">
    <div class="card" id="card">
      <!-- ê²‰í‘œì§€ -->
      <section class="front">
        <div class="badge">ğŸ„ Merry Christmas</div>
        <h1>ì—„ë§ˆì—ê²Œ</h1>
        <p>í´ë¦­í•˜ë©´ ì¹´ë“œê°€ í¼ì³ì§€ê³ <br/>ì‚°íƒ€í• ì•„ë²„ì§€ê°€ ë“±ì¥ + ì‚¬ê°íŒŒ ìºëŸ´ ğŸ…ğŸ”Š</p>
        <div class="badge">âœ¨ From. ì •í›ˆ</div>
      </section>

      <!-- ì•ˆìª½ -->
      <section class="inside">
        <div class="left">
          <h2>ì—„ë§ˆ, ë©”ë¦¬ í¬ë¦¬ìŠ¤ë§ˆìŠ¤! ğŸ</h2>
          <div class="msg" id="msg">
            ì—„ë§ˆ!<br/>
            ì˜¬í•´ë„ ì €ë¥¼ ì±™ê²¨ì£¼ê³  ì‘ì›í•´ì¤˜ì„œ ì •ë§ ê³ ë§ˆì›Œìš”.<br/>
            ì—„ë§ˆê°€ ìˆì–´ì„œ ë§¤ì¼ ë“ ë“ í•´ìš”.<br/>
            í¬ë¦¬ìŠ¤ë§ˆìŠ¤ì—ëŠ” í‘¹ ì‰¬ê³ , í–‰ë³µí•œ ì¼ë§Œ ê°€ë“í–ˆìœ¼ë©´ ì¢‹ê² ì–´ìš”!<br/><br/>
            <strong>ì‚¬ë‘í•´ìš” â¤ï¸</strong>
          </div>

          <div class="sig">
            <span id="dateText"></span>
            <span><strong>- ì •í›ˆì´ ë“œë¦¼</strong></span>
          </div>
        </div>

        <div class="right">
          <div class="bubble" id="bubble">
            ğŸ… ì‚°íƒ€í• ì•„ë²„ì§€: â€œì—„ë§ˆì—ê²Œ ë”°ëœ»í•œ ì„ ë¬¼ì´ ë„ì°©í–ˆë‹¨ë‹¤!â€
          </div>

          <!-- ì‚°íƒ€ SVG -->
          <svg class="santaWrap" viewBox="0 0 260 260" role="img" aria-label="ì‚°íƒ€í• ì•„ë²„ì§€">
            <path d="M70 85 C85 35, 170 30, 190 95 C165 88, 130 90, 70 85 Z" fill="#e53935"/>
            <circle cx="198" cy="96" r="16" fill="#fff"/>
            <path d="M60 92 C95 120, 170 120, 205 92 C210 110, 200 125, 185 132 C145 150, 105 150, 75 132 C60 125, 50 110, 60 92 Z" fill="#fff"/>

            <circle cx="130" cy="140" r="54" fill="#ffccbc"/>
            <path d="M80 150 C85 205, 175 205, 180 150 C170 178, 150 195, 130 195 C110 195, 90 178, 80 150 Z" fill="#fff"/>
            <circle cx="130" cy="148" r="10" fill="#ffab91"/>
            <circle cx="110" cy="138" r="6" fill="#222"/>
            <circle cx="150" cy="138" r="6" fill="#222"/>
            <path d="M98 126 C110 118, 120 118, 128 126" stroke="#5d4037" stroke-width="6" stroke-linecap="round" fill="none"/>
            <path d="M162 126 C150 118, 140 118, 132 126" stroke="#5d4037" stroke-width="6" stroke-linecap="round" fill="none"/>

            <path d="M70 210 C85 175, 175 175, 190 210 C175 232, 85 232, 70 210 Z" fill="#e53935"/>
            <rect x="85" y="198" width="90" height="18" rx="9" fill="#222"/>
            <rect x="122" y="195" width="22" height="24" rx="4" fill="#fdd835"/>

            <rect x="22" y="198" width="46" height="46" rx="8" fill="#6bc5ff"/>
            <rect x="41" y="198" width="8" height="46" fill="#fff"/>
            <rect x="22" y="218" width="46" height="8" fill="#fff"/>
            <path d="M32 198 C30 186, 44 186, 41 198" fill="#fff"/>
            <path d="M58 198 C60 186, 46 186, 49 198" fill="#fff"/>

            <circle cx="220" cy="160" r="4" fill="#ffd36e"/>
            <circle cx="235" cy="140" r="3" fill="#ffd36e"/>
            <circle cx="215" cy="125" r="3" fill="#ffd36e"/>
          </svg>

          <div class="controls">
            <button type="button" id="btnTalk">ì‚°íƒ€ ë§ ë°”ê¾¸ê¸°</button>
            <button type="button" id="btnReplay">ìºëŸ´ ë‹¤ì‹œ ì¬ìƒ</button>
          </div>
        </div>
      </section>
    </div>

    <!-- í´ë¦­ìš© íˆ¬ëª… ë ˆì´ì–´ -->
    <div class="clickable" id="clickArea" title="í´ë¦­í•´ì„œ ì—´ê¸°"></div>
  </div>

  <script>
    const stage = document.getElementById('stage');
    const clickArea = document.getElementById('clickArea');
    const dateText = document.getElementById('dateText');
    const bubble = document.getElementById('bubble');
    const btnTalk = document.getElementById('btnTalk');
    const btnReplay = document.getElementById('btnReplay');

    // ë‚ ì§œ í‘œì‹œ
    const d = new Date();
    const yyyy = d.getFullYear();
    const mm = String(d.getMonth()+1).padStart(2,'0');
    const dd = String(d.getDate()).padStart(2,'0');
    dateText.textContent = `${yyyy}.${mm}.${dd}`;

    // ì‚°íƒ€ ë©˜íŠ¸
    const lines = [
      'ğŸ… ì‚°íƒ€í• ì•„ë²„ì§€: â€œì—„ë§ˆëŠ” ì˜¬í•´ë„ ìµœê³ ë¡œ ë©‹ì¡Œë‹¨ë‹¤!â€',
      'ğŸ… ì‚°íƒ€í• ì•„ë²„ì§€: â€œì •í›ˆì´ê°€ ì‚¬ë‘ì„ í•œê°€ë“ ë‹´ì•„ ë³´ëƒˆë‹¨ë‹¤!â€'
    ];
    let idx = 0;
    btnTalk.addEventListener('click', (e) => {
      e.stopPropagation();
      idx = (idx + 1) % lines.length;
      bubble.textContent = lines[idx];
    });

    /* =========================
       ì‚¬ê°íŒŒ(ğŸ›ï¸ square wave) ìºëŸ´
       - ë¸Œë¼ìš°ì € ì •ì±…ìƒ "ì‚¬ìš©ì í´ë¦­" í›„ì—ë§Œ ì†Œë¦¬ ì¬ìƒ ê°€ëŠ¥
       - Web Audio APIë¡œ ê°„ë‹¨í•œ ë©œë¡œë””(ì§•ê¸€ë²¨ í•œ êµ¬ì ˆ ëŠë‚Œ) ì—°ì£¼
       ========================= */

    let audioCtx = null;
    let isPlaying = false;

    // ìŒê³„ ì´ë¦„ -> ì£¼íŒŒìˆ˜ (A4=440 ê¸°ì¤€)
    const NOTE_FREQ = {
      "C4": 261.63, "D4": 293.66, "E4": 329.63, "F4": 349.23, "G4": 392.00, "A4": 440.00, "B4": 493.88,
      "C5": 523.25, "D5": 587.33, "E5": 659.25
    };

    // ì•„ì£¼ ê°„ë‹¨ ìºëŸ´ ë©œë¡œë””(ê³µê°œ/ê³ ì „ ë©œë¡œë”” ëŠë‚Œìœ¼ë¡œ ì§§ê²Œ)
    // [note, beats] / note=nullì´ë©´ ì‰¼í‘œ(rest)
    const MELODY = [
      ["E4", 1], ["E4", 1], ["E4", 2],
      ["E4", 1], ["E4", 1], ["E4", 2],
      ["E4", 1], ["G4", 1], ["C4", 1], ["D4", 1], ["E4", 4],
      [null, 1],
      ["F4", 1], ["F4", 1], ["F4", 1], ["F4", 1], ["F4", 1], ["E4", 1], ["E4", 2],
      ["E4", 1], ["D4", 1], ["D4", 1], ["E4", 1], ["D4", 2], ["G4", 2]
    ];

    async function ensureAudioContext(){
      if(!audioCtx){
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      }
      if(audioCtx.state === "suspended"){
        await audioCtx.resume();
      }
    }

    function playSquareNote(freq, startTime, durationSec){
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();

      osc.type = "square";              // âœ… ìš”ì²­: ì‚¬ê°íŒŒ
      osc.frequency.setValueAtTime(freq, startTime);

      // í´ë¦­ ì†Œë¦¬(íŒ) ì¤„ì´ë ¤ê³  ì•„ì£¼ ì§§ì€ ì—”ë²¨ë¡œí”„
      const attack = 0.01;
      const release = 0.06;
      const peak = 0.13;  // ë„ˆë¬´ í¬ë©´ ì‚‘ì‚‘ í­ì£¼í•˜ë‹ˆê¹Œ ì ë‹¹íˆ
      gain.gain.setValueAtTime(0.0001, startTime);
      gain.gain.exponentialRampToValueAtTime(peak, startTime + attack);
      gain.gain.exponentialRampToValueAtTime(0.0001, startTime + Math.max(attack, durationSec - release));

      osc.connect(gain);
      gain.connect(audioCtx.destination);

      osc.start(startTime);
      osc.stop(startTime + durationSec);
    }

    async function playCarol(){
      if(isPlaying) return;
      isPlaying = true;

      try{
        await ensureAudioContext();

        const bpm = 140;                 // í…œí¬
        const beatSec = 60 / bpm;
        let t = audioCtx.currentTime + 0.05;

        for(const [note, beats] of MELODY){
          const dur = beats * beatSec;
          if(note && NOTE_FREQ[note]){
            playSquareNote(NOTE_FREQ[note], t, dur);
          }
          t += dur;
        }
      } finally{
        // ëŒ€ì¶© ëë‚˜ëŠ” ì‹œê°„ ê³„ì‚°í•´ì„œ isPlaying í•´ì œ
        const bpm = 140;
        const beatSec = 60 / bpm;
        const totalBeats = MELODY.reduce((s, x) => s + x[1], 0);
        const totalSec = totalBeats * beatSec;
        setTimeout(() => { isPlaying = false; }, Math.ceil(totalSec * 1000) + 200);
      }
    }

    // âœ… í•œ ë²ˆ ëˆ„ë¥´ë©´ ì•ˆ ë‹«íˆê²Œ + ê·¸ë•Œ ìºëŸ´ ì¬ìƒ
    clickArea.addEventListener('click', async () => {
      stage.classList.add('open');             // ë¬´ì¡°ê±´ ì—´ê¸°
      clickArea.style.pointerEvents = 'none';  // ë‹¤ì‹œ í´ë¦­ ëª» í•˜ê²Œ(ì˜êµ¬ ì˜¤í”ˆ)
      await playCarol();                       // ì—´ë¦´ ë•Œ ì‚¬ê°íŒŒ ìºëŸ´!
    });

    // ìºëŸ´ ë‹¤ì‹œ ì¬ìƒ ë²„íŠ¼
    btnReplay.addEventListener('click', async (e) => {
      e.stopPropagation();
      await playCarol();
    });

    // Enter/Spaceë„ ì—´ê¸°(í•œ ë²ˆë§Œ)
    document.addEventListener('keydown', async (e) => {
      if(e.key === 'Enter' || e.key === ' '){
        if(clickArea.style.pointerEvents !== 'none'){
          stage.classList.add('open');
          clickArea.style.pointerEvents = 'none';
          await playCarol();
        }
      }
    });
  </script>
</body>
</html>

